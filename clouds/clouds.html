<!DOCTYPE html>
<html>
<head>
	<title>Clouds</title>
	<style type="text/css">
		#canvas {
			border: 1px solid #000;
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			margin: auto;
		}
	</style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>

// requestAnimationFrame() shim
(function() {
	var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestANimationFrame || window.msRequestANimationFrame;
	window.requestAnimationFrame = requestAnimationFrame;
})();

// Initializing variables
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var width = window.innerWidth;
var height = window.innerHeight;
var offsetY = 1;
var growthSpeed = 1;
var clouds = [];

canvas.width = width;
canvas.height = height;

window.setInterval(function() {addCloud();}, 500);

function update() {
	// Draw sky
	ctx.fillStyle = "#66ccff";
	ctx.fillRect(0, 0, width, height);

	updateClouds();

	requestAnimationFrame(update);
}

function addCloud() {
	var initCloudSize = 200;
	clouds.push({
		color : getRandomColor(),
		x : getRandomWidth(),
		y : getRandomHeight(),
		cloudSize : initCloudSize,
		width : initCloudSize,
		height : initCloudSize,
		cloudOpacity : 0,
		cloudDestroy : false
	});
}

function updateClouds() {
	for (var i = 0; i < clouds.length; i++) {
		var cloud = clouds[i];
		ctx.fillStyle = cloud.color;
		ctx.fillRect(cloud.x, cloud.y, cloud.width, cloud.height);
		updateCloud(cloud);
	}
}

function updateCloud(cloud) {
	cloud.cloudSize += growthSpeed;
	if (cloud.cloudOpacity > 1)
		cloud.cloudDestroy = true;
	if (cloud.cloudDestroy) {
		if (cloud.cloudOpacity < 0)
			return;
		cloud.cloudOpacity -= 0.016;
	} else
		cloud.cloudOpacity += 0.004;
	cloud.color = getRandomColor(cloud.cloudOpacity);
	cloud.x -= growthSpeed / 2;
	cloud.y -= growthSpeed / 2 - offsetY;
	cloud.width = cloud.cloudSize;
	cloud.height = cloud.cloudSize / 2;
}

function getRandomColor(opacity) {
	var letters = '0123456789ABCDEF'.split('');
	var color = '#';
	for (var i = 0; i < 6; i++) {
		color += letters[Math.round(Math.random() * 15)];
	}
	//return color;
	return "rgba(255, 255, 255, " + opacity + ")";
	//return "rgba(" + Math.round(Math.random() * 255) + ", " + Math.round(Math.random() * 255) + ", " + Math.round(Math.random() * 255) + ", " + opacity + ")";
}

function getRandomWidth() {
	return Math.round(Math.random() * width);
}

function getRandomHeight() {
	return height / 2;
	return height / 2 + Math.round(Math.random() * height / 10);
}

window.addEventListener("load", function() {
	update();
});

</script>
</body>
</html>